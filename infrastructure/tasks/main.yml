- name: Install docker & docker-compose from PyPi
  ansible.builtin.pip:
    name:
      - docker
      - docker-compose

- name: Git checkout
  ansible.builtin.git:
    repo: "{{ git_repository }}"
    dest: "{{ deployment_path }}"
    version: "{{ git_branch }}"

- name: Run `docker-compose up`
  community.docker.docker_compose:
    project_src: "{{ deployment_path }}"
    build: true
    debug: true
  environment:
    SSH_PUBLIC_KEY: "{{ lookup('file', '/home/panda/.ssh/id_rsa.pub') }}"
    SSH_PRIVATE_KEY: "{{ lookup('file', '/home/panda/.ssh/id_rsa') }}"
